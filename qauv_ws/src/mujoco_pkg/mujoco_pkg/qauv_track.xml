<?xml version="1.0" encoding="utf-8"?>
<mujoco model="qauv_track">
    <option timestep="0.002" gravity="0 0 -9.81" integrator="implicitfast" density="1000" viscosity="0.0009">
        <flag passive="enable"/>
    </option>

    <compiler meshdir="/home/zb/qauv_ws/src/mujoco_pkg/mujoco_pkg/assets" angle="radian" autolimits="true"/>

    <visual>
        <global realtime="1"/>
        <!-- <quality shadowsize="16384" numslices="28" offsamples="4"/> -->
        <quality shadowsize="4096" numslices="28" offsamples="4"/>
        <headlight diffuse="1 1 1" specular="0.5 0.5 0.5" active="1"/>
        <rgba fog="1 1 1 1" haze="1 1 1 1"/>
    </visual>

    <asset>
        <mesh file="body_no_steer.stl"/>
        <mesh file="prop_left.stl"/>
        <mesh file="prop_right.stl"/>
        <mesh file="steer.stl"/>
        <mesh file="belt.stl"/>
        <mesh file="finger.stl"/>

        <texture name="sky" type="skybox" file="assets/desert.png" gridsize="3 4" gridlayout=".U..LFRB.D.."/>

        <!-- <texture name="ground" type="2d" builtin="flat" rgb1="0.1 0.3 0.6" width="256" height="256"/> -->
        <texture name="ground" type="2d" builtin="checker" rgb1="0.1 0.1 0.1" rgb2="0.9 0.9 0.9" width="256" height="256" mark="cross" markrgb="0.8 0.8 0.8"/>
        <material name="ground" texture="ground" reflectance="0" texrepeat="1 1" texuniform="true"/>
    </asset>

    <default>
        <default class="friction">
            <geom condim="4" friction="0.9 0.5 0.1" solimp="0.9 0.95 0.001 0.5 2" solref="0.02 1"/>
        </default>
        <default class="fluid">
            <geom fluidshape="ellipsoid" fluidcoef="1.2 1.0 1.2 0.1 0.1"/>
        </default>
    </default>

    <worldbody>
        <light type="directional" pos="30 30 30" dir="0 -1 -1" diffuse="0.5 0.5 0.5" ambient="0.3 0.3 0.3" specular="0.5 0.5 0.5"/>

        <geom name="ground" type="plane" material="ground" pos="0 0 0" size="5 5 0.1" class="friction"/>

        <body name="qauv" pos="0.035 0 0.8">
            <joint name="body_joint" type="free"/>
            <geom name="body_no_steer" type="mesh" mesh="body_no_steer" rgba="0.3 0.9 0.7 1" mass="2.466" class="fluid"/>
            <!-- <geom name="body_no_steer" type="mesh" mesh="body_no_steer" rgba="0.3 0.9 0.7 1" mass="2.4594" class="fluid"/> -->
            <geom name="prop_1" type="mesh" mesh="prop_left" pos="0.0891332 -0.0891332 -0.00535" rgba="0.3 0.3 0.3 1" mass="0.17" class="fluid"/>
            <geom name="prop_2" type="mesh" mesh="prop_right" pos="-0.0891332 -0.0891332 -0.00535" rgba="0.3 0.3 0.3 1" mass="0.17" class="fluid"/>
            <geom name="prop_3" type="mesh" mesh="prop_left" pos="-0.0891332 0.0891332 -0.00535" quat="0 0 0 1" rgba="0.3 0.3 0.3 1" mass="0.17" class="fluid"/>
            <geom name="prop_4" type="mesh" mesh="prop_right" pos="0.0891332 0.0891332 -0.00535" quat="0 0 0 1" rgba="0.3 0.3 0.3 1" mass="0.17" class="fluid"/>
            <geom name="steer" type="mesh" mesh="steer" pos="-0.0102289 -0.0650948 -0.08505" rgba="0.7 0.7 0.7 1" mass="0.09"/>
            <geom name="belt" type="mesh" mesh="belt" pos="0.0256 -0.0826079 -0.109692" rgba="0.3 0.3 0.3 1" mass="0.01"/>
            <geom name="balance_weight_1" type="box" pos="-0.062 0 -0.08" quat="0.7071 0 0 0.7071" rgba="0.5 0.5 0.5 1" size="0.01 0.002 0.01" mass="0.106"/>
            <geom name="balance_weight_2" type="box" pos="0 0.062 -0.08" quat="1 0 0 0" rgba="0.5 0.5 0.5 1" size="0.01 0.002 0.01" mass="0.128"/>
            <!-- <geom name="balance_weight_1" type="box" pos="-0.062 0 -0.08" quat="0.7071 0 0 0.7071" rgba="0.5 0.5 0.5 1" size="0.01 0.002 0.01" mass="0.1126"/>
            <geom name="balance_weight_2" type="box" pos="0 0.062 -0.08" quat="1 0 0 0" rgba="0.5 0.5 0.5 1" size="0.01 0.002 0.01" mass="0.128"/> -->

            <body name="fing_1" pos="0 -0.02 -0.163">
                <joint name="fing_1_joint" type="hinge" axis="1 0 0" damping="0.005" limited="true" range="0 0.4"/>
                <geom name="fing_1" type="mesh" mesh="finger" rgba="0.7 0.7 0.7 1" mass="0.035" class="friction"/>
            </body>

            <body name="fing_2" pos="0 0.02 -0.163" quat="0 0 0 1">
                <joint name="fing_2_joint" type="hinge" axis="1 0 0" damping="0.005" limited="true" range="0 0.4"/>
                <geom name="fing_2" type="mesh" mesh="finger" rgba="0.7 0.7 0.7 1" mass="0.035" class="friction"/>
            </body>

            <site name="prop_1_site" pos="0.0891332 0.0891332 -0.01528"/>
            <site name="prop_2_site" pos="-0.0891332 0.0891332 -0.01528"/>
            <site name="prop_3_site" pos="-0.0891332 -0.0891332 -0.01528"/>
            <site name="prop_4_site" pos="0.0891332 -0.0891332 -0.01528"/>
            <!-- <site name="buoyancy_site" pos="0 0 0"/> -->
            <site name="buoyancy_site" pos="0 0 -0.013"/>
            <site name="imu_site" pos="0 0 0"/>
            <site name="dep_site" pos="-0.014 0.0376 -0.127"/>
            <site name="cam_site" pos="-0.035 0 -0.11"/>

            <camera name="cam" mode="fixed" fovy="45" pos="-0.03 0 -0.11" quat="0.707106 0 0 0.707106"/>
        </body>

        <body name="object" pos="1 1 1" gravcomp="1">
            <joint name="obj_joint" type="free"/>
            <geom name="object" type="box" rgba="1 0 0 1" size="0.02 0.02 0.02" mass="0.01"/>
        </body>

        <site name="world_z" pos="0 0 0"/>
    </worldbody>

    <contact>
        <!-- <pair geom1="fing_1" geom2="object" margin="0.001" class="friction"/>
        <pair geom1="fing_2" geom2="object" margin="0.001" class="friction"/> -->
        <exclude body1="qauv" body2="fing_1"/>
        <exclude body1="qauv" body2="fing_2"/>
    </contact>

    <tendon>
        <fixed name="grasping">
            <joint joint="fing_1_joint" coef="0.5"/>
            <joint joint="fing_2_joint" coef="0.5"/>
        </fixed>
    </tendon>

    <equality>
        <joint joint1="fing_1_joint" joint2="fing_2_joint"/>
    </equality>

    <actuator>
        <motor name="prop_1_act" gear="0 0 1 0 0 -1.2e-03" site="prop_1_site" ctrllimited="true" ctrlrange="-15 15"/>
        <motor name="prop_2_act" gear="0 0 1 0 0 1.2e-03" site="prop_2_site" ctrllimited="true" ctrlrange="-15 15"/>
        <motor name="prop_3_act" gear="0 0 1 0 0 -1.2e-03" site="prop_3_site" ctrllimited="true" ctrlrange="-15 15"/>
        <motor name="prop_4_act" gear="0 0 1 0 0 1.2e-03" site="prop_4_site" ctrllimited="true" ctrlrange="-15 15"/>
        <general name="grasping" tendon="grasping" gear="1 0 0 0 0 0" ctrllimited="true" ctrlrange="0 1" biastype="affine" biasprm="-0.1 0 0 0 0 0"/>

        <!-- 重力=3.55*9.81=34.8255 -->
        <general name="buoyancy" site="buoyancy_site" refsite="world_z" 
            gaintype="fixed"   gainprm="0 0 0 0 0 0"
            biastype="affine"  biasprm="36.2 0 0 0 0 0"
            gear="0 0 1 0 0 0" ctrllimited="false"/>
    </actuator>

    <sensor>
        <framequat name="body_quat" objtype="site" objname="imu_site"/>
        <gyro name="body_gyro" site="imu_site"/>
        <accelerometer name="body_acce" site="imu_site"/>
        <framepos name="body_dep" objtype="site" objname="dep_site"/>
    </sensor>
</mujoco>
